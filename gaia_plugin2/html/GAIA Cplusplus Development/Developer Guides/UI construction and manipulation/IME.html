<div>
<a href = "../../../GAIA Cplusplus Development.html">GAIA Cplusplus Development</a>&gt;<a href = "../../Developer Guides.html">Developer Guides</a>&gt;<a href = "../UI construction and manipulation.html">UI construction and manipulation</a>&gt;
</div>
<h1>Input Method Editor (IME)</h1>
<hr />
<h2>IME Customization</h2>
<p>Gaia provide a way to customize an IME. As we know, an IME is a background-running service which does nothing
but waiting for the requirement of editing from user. On starting input, the service will provide a UI serface
to interact with the user.</p>
<p>If you want to customize one, please create a new class which is inherited by the class <strong>IMEService</strong> and
listener. Then you should override some functions to attach the UI to service or doing something.</p>
<p>In this example, we use <strong>OnKeyboardActionListener</strong> as a listener set to IMEKeyboardWidget, and override
"onCreateInputView()" function to return a input view to this service.</p>
<pre><code>class MyIME : public IMEService
            , public OnKeyboardActionListener {
    // override
    virtual IMEKeyboardWidget* onCreateInputView();
};

Widget* MyIME::onCreateInputView() {
    Wiget* pWidget = new IMEKeyboardWidget();
    // initial the keyboard widget
    return pWidget;
}
</code></pre>
<hr />
<p>Following are IME related class in gaia.</p>
<h2>Class List</h2>
<ul>
<li>InputMethodManager</li>
<li>InputMethodInfo</li>
<li>InputMethodConnection</li>
<li>IMECompletionInfo</li>
<li>IMEInfo</li>
<li>IMEKeyboard</li>
<li>IMEKeyboardRow</li>
<li>IMEKeyboardKey</li>
<li>IMEKeyboardWidget</li>
<li>OnKeyboardActionListener</li>
<li>IMEService</li>
</ul>
<hr />
<h2>Input Method Manager</h2>
<p>In SDK, Gaia provide the InputMethodManager to arbitrates interaction between applications and the current input method.</p>
<ul>
<li>The <strong>input method manager</strong> as expressed by this class is the central point of the system that manages interaction 
    between all other parts. It exists in each application context and commuicates with a global system service that 
    manages the interaction across all processes.</li>
<li>An <strong>input method (IME)</strong> implements an interaction model allowing the user to generate text. The system binds to the 
    current input method that is use, causing it to be created and run, and tells it when to hide and show its UI. Only 
    one IME is running at a time.</li>
<li>Only one client application could working with the IME at a time.</li>
</ul>
<p>While you need to arbitrates interaction between the text area and the IME, please use input method manager and there will be some simple functions to use.</p>
<p>Usage: You must new this instance with TextWidget</p>
<p>Header file : <strong>gaia/service/InputMethodManager.h</strong></p>
<pre><code>InputMethodManager* pImm = new InputMethodManager();  
pImm-&gt;showSoftInput(TextWidget);
delete pImm;
</code></pre>
<hr />
<h2>Input Method Info</h2>
<p>This class is used to specify meta information of an input method.</p>
<p>The InputMethodInfo can only get from InputMethodManager. </p>
<p>Header file : <strong>gaia/service/InputMethodInfo.h</strong></p>
<pre><code>InputMethodManager* pImm = new InputMethodManager();
Vector&lt;InputMethodInfo*&gt; infoList = pImm-&gt;getInputMethodList();
String id = infoList.itemAt(i)-&gt;getId();
delete pImm;
for(size_t i;i&lt;infoList.size();i++) {
    delete infoList.itemAt(i);
}
</code></pre>
<hr />
<h2>Input Method Connection</h2>
<p>This class is the communication channel from an InputMethod back to the application that is receiving its input. 
It is used to perform such things as reading text around the cursor, committing text to the text box, and sending 
raw key events to the application.</p>
<p>The connection can only get from IMEService.</p>
<p>Header file : <strong>gaia/service/InputMethodConnection.h</strong></p>
<pre><code>InputMethodConnection* pImc = IMEService::getCurrentInputMethodConnection();
int code = 100;
pImc-&gt;commitText(String::valueOf((char16_t)code),1);
delete pImc;
</code></pre>
<hr />
<h2>IME Completion Info</h2>
<p>Information about a single text completion that an editor has reported to an input method.</p>
<p>For IME customization.</p>
<p>Header file : <strong>gaia/service/IMECompletionInfo.h</strong></p>
<hr />
<h2>IME Info</h2>
<p>An IMEInfo describes several attributes of a text editing object that an input method is communicating with (typically an EditWidget), 
most importantly the type of text content it contains.</p>
<p>For IME customization.</p>
<p>Header file : <strong>gaia/service/IMEInfo.h</strong></p>
<hr />
<h2>IME Keyboard</h2>
<p>Loads an XML description of a keyboard and stores the attributes of the keys. A keyboard consists of rows of keys.</p>
<p>For IME customization. You can inherit it and override some function to customize it.</p>
<p>The layout file for a keyboard contains XML that looks like the following snippet:<br />
</p>
<pre><code>&lt;Keyboard android:keyWidth="10%p"
          android:keyHeight="50px"  
          android:horizontalGap="2px"  
          android:verticalGap="2px" &gt;  
          &lt;Row android:keyWidth="32px" &gt;  
               &lt;Key android:keyLabel="A" /&gt;  
               ...  
          &lt;/Row&gt;  
          ...  
&lt;/Keyboard&gt;
</code></pre>
<table border="1" width="100%">
<tr><th colspan="2">XML Attributes</th></tr>
<tr><th>Attribute Name</th><th>Description</th></tr>
<tr><td>android:horizontalGap</td><td>Default horizontal gap between keys.</td></tr>
<tr><td>android:keyHeight</td><td>Default height of a key, in pixels or percentage of display width. </td></tr>
<tr><td>android:keyWidth</td><td>Default width of a key, in pixels or percentage of display width. </td></tr>
<tr><td>android:verticalGap</td><td>Default vertical gap between rows of keys. </td></tr>
</table>

<p><br>
<table border="1" width="400">
<tr><th colspan="2">Valid units</th></tr>
<tr><td>px</td><td>pixels</td></tr>
<tr><td>dp</td><td>density-independent pixels</td></tr>
<tr><td>sp</td><td>scaled pixels based on preferred font size</td></tr>
<tr><td>in</td><td>inches</td></tr>
<tr><td>mm</td><td>millimeters</td></tr>
<tr><td>%</td><td>percentage of the base size</td></tr>
<tr><td>%p</td><td>a size relative to some parent container</td></tr>
</table></p>
<p>Header file : <strong>gaia/service/IMEKeyboard.h</strong></p>
<pre><code>class MyKeyboard : public IMEKeyboard {
    //members and function declaration here
    };

MyKeyboard* myKeyboard = new MyKeyboard(IMEService, Resource_ID);
myKeyboard-&gt;initializer(IMEService, Resource_ID);
delete myKeyboard;
</code></pre>
<hr />
<h2>IMEKeyboardRow</h2>
<p>Container for keys(IMEKeyboardKey) in the keyboard(IMEKeyboard). All keys in a row are at the same Y-coordinate. 
Some of the key size defaults can be overridden per row from what the Keyboard defines.</p>
<p>For IME customization. You can inherit it and override some function to customize it.</p>
<table border="1" width="100%">
<tr><th colspan="2">XML Attributes</th></tr>
<tr><th>Attribute Name</th><th>Description</th></tr>
<tr><td>android:horizontalGap</td><td>Default horizontal gap between keys.</td></tr>
<tr><td>android:keyHeight</td><td>Default height of a key, in pixels or percentage of display width. </td></tr>
<tr><td>android:keyWidth</td><td>Default width of a key, in pixels or percentage of display width. </td></tr>
<tr><td>android:verticalGap</td><td>Default vertical gap between rows of keys. </td></tr>
<tr><td>android:keyboardMode</td><td>Mode of the Keyboard. </td></tr>
<tr><td>android:rowEdgeFlags</td><td>Row edge flags. </td></tr>
</table>

<p><br>
<table border="1" width="400">
<tr><th colspan="2">Valid units</th></tr>
<tr><td>px</td><td>pixels</td></tr>
<tr><td>dp</td><td>density-independent pixels</td></tr>
<tr><td>sp</td><td>scaled pixels based on preferred font size</td></tr>
<tr><td>in</td><td>inches</td></tr>
<tr><td>mm</td><td>millimeters</td></tr>
<tr><td>%</td><td>percentage of the base size</td></tr>
<tr><td>%p</td><td>a size relative to some parent container</td></tr>
</table>
<br>
<table border="1" width="600">
<tr><th colspan="3">Row edge flags</th></tr>
<tr><th>Constant</th><th>Value</th><th>Description</th></tr>
<tr><td>top</td><td>4</td><td>Row is anchored to the top of the keyboard</td></tr>
<tr><td>bottom</td><td>8</td><td>Row is anchored to the bottom of the keyboard</td></tr>
</table></p>
<p>Header file : <strong>gaia/service/IMEKeyboardRow.h</strong></p>
<hr />
<h2>IMEKeyboardKey</h2>
<p>Class for describing the position and characteristics of a single key in the keyboard.</p>
<p>For IME customization. You can inherit it and override some function to customize it.</p>
<table border="1" width="100%">
<tr><th colspan="2">XML Attributes</th></tr>
<tr><th>Attribute Name</th><th>Description</th></tr>
<tr><td>android:codes</td><td>The unicode value or comma-separated values that this key outputs. </td></tr>
<tr><td>android:horizontalGap</td><td>Default horizontal gap between keys.</td></tr>
<tr><td>android:iconPreview</td><td>The icon to show in the popup preview. </td></tr>
<tr><td>android:isModifier</td><td>Whether this is a modifier key such as Alt or Shift. </td></tr>
<tr><td>android:isRepeatable</td><td>Whether long-pressing on this key will make it repeat. </td></tr>
<tr><td>android:isSticky</td><td>Whether this is a toggle key. </td></tr>
<tr><td>android:keyEdgeFlags</td><td>Key edge flags. </td></tr>
<tr><td>android:keyHeight</td><td>Default height of a key, in pixels or percentage of display width. </td></tr>
<tr><td>android:keyIcon</td><td>The icon to display on the key instead of the label. </td></tr>
<tr><td>android:keyLabel</td><td>The label to display on the key. </td></tr>
<tr><td>android:keyOutputText</td><td>The string of characters to output when this key is pressed. </td></tr>
<tr><td>android:keyWidth</td><td>Default width of a key, in pixels or percentage of display width. </td></tr>
<tr><td>android:popupCharacters</td><td>The characters to display in the popup keyboard. </td></tr>
<tr><td>android:popupKeyboard</td><td>The XML keyboard layout of any popup keyboard. </td></tr>
</table>

<p><br>
<table border="1" width="400">
<tr><th colspan="2">Valid units</th></tr>
<tr><td>px</td><td>pixels</td></tr>
<tr><td>dp</td><td>density-independent pixels</td></tr>
<tr><td>sp</td><td>scaled pixels based on preferred font size</td></tr>
<tr><td>in</td><td>inches</td></tr>
<tr><td>mm</td><td>millimeters</td></tr>
<tr><td>%</td><td>percentage of the base size</td></tr>
<tr><td>%p</td><td>a size relative to some parent container</td></tr>
</table>
<br>
<table border="1" width="600">
<tr><th colspan="3">Key edge flags</th></tr>
<tr><th>Constant</th><th>Value</th><th>Description</th></tr>
<tr><td>left</td><td>1</td><td>Key is anchored to the left of the keyboard</td></tr>
<tr><td>right</td><td>2</td><td>Key is anchored to the right of the keyboard</td></tr>
</table></p>
<p>Header file : <strong>gaia/service/IMEKeyboardKey.h</strong></p>
<hr />
<h2>IME Keyboard Widget</h2>
<p>A widget that renders a virtual Keyboard. It handles rendering of keys and detecting key presses and touch movements.</p>
<p>For IME customization. You can inherit it and override some function to customize it.</p>
<table border="1" width="100%">
<tr><th colspan="2">XML Attributes</th></tr>
<tr><th>Attribute Name</th><th>Description</th></tr>
<tr><td>android:keyBackground</td><td>Image for the key. </td></tr>
<tr><td>android:keyPreviewLayout</td><td>Layout resource for key press feedback.</td></tr>
<tr><td>android:keyPreviewOffset</td><td>Vertical offset of the key press feedback from the key.</td></tr>
<tr><td>android:keyTextColor</td><td>Color to use for the label in a key.</td></tr>
<tr><td>android:keyTextSize</td><td>Size of the text for character keys.</td></tr>
<tr><td>android:labelTextSize</td><td>Size of the text for custom keys with some text and no icon.</td></tr>
<tr><td>android:popupLayout</td><td>Layout resource for popup keyboards.</td></tr>
<tr><td>android:verticalCorrection</td><td>Amount to offset the touch Y coordinate by, for bias correction.</td></tr>
</table>

<p>Header file : <strong>gaia/service/IMEKeyboardWidget.h</strong></p>
<pre><code>class MyKeyboardWidget : public gaia::service::IMEKeyboardWidget {
    //members and function declaration here
};

MyKeyboardWidget* myKeyboardWidget = new gaia::service::IMEKeyboardWidget();
IMEService::initialKeyboardWidget(myKeyboardWidget, Resource_ID);
myKeyboardWidget-&gt;setOnKeyboardActionListener(IMEService);
myKeyboardWidget-&gt;setKeyboard(IMEKeyboard);
delete myKeyboardWidget;
</code></pre>
<hr />
<h2>On Keyboard Action Listener</h2>
<p>Listener for virtual keyboard events. For example 'onKey()'.</p>
<p>For IME customization. You should inherit it and IMEService to customize it.</p>
<p>Header file : <strong>gaia/service/IMEKeyboardWidget.h</strong></p>
<pre><code>class MyKeyboardService : public IMEService, public OnKeyboardActionListener {
    // members and function delcaration
};

//override
void onKey(int primaryCode, const gaia::base::Vector&lt;int32_t&gt;&amp; keyCodes) {
    //inplements here
}
</code></pre>
<hr />
<h2>IME Service</h2>
<p>IMEService provides a standard implementation of an InputMethod, which final implementations can derive from and customize.
This provides a basic framework for standard UI elements (input view, candidates view, and running in fullscreen mode), but it is 
up to a particular implementor to decide how to use them. For example, one input method could implement an input area with a 
keyboard, another could allow the user to draw text, while a third could have no input area (and thus not be visible to the user) 
but instead listen to audio and perform text to speech conversion.</p>
<p>In the implementation provided here, all of these elements are placed together in a single window managed by the IMEService. 
It will execute callbacks as it needs information about them, and provides APIs for programmatic control over them. They layout of 
these elements is explicitly defined:</p>
<ul>
<li>The soft input view, if available, is placed at the bottom of the screen.</li>
<li>The candidates view, if currently shown, is placed above the soft input view.</li>
<li>If not running fullscreen, the application is moved or resized to be above these views; if running fullscreen, the window will 
completely cover the application and its top part will contain the extract text of what is currently being edited by the application.</li>
</ul>
<p>For IME customization. You should inherit it and override some function to customize it.</p>
<p>Header file : <strong>gaia/service/IMEService.h</strong></p>
<pre><code>class CustomizeKeyboard : public IMEService {
    //members and function declarations here
};

//override
void onInitializeInterface() {
    //inplements here
}
</code></pre>